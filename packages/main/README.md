# 周界 2D

## 待办

- [x] 登录功能
- [x] 工程搭建
- [x] 静态页面
- [x] 页面布局
- [x] 实时告警静态部分
- [x] 实时告警引入真实数据
- [x] 实时告警滚动条
- [x] 实时告警 5 秒没有推送数据，删除该条告警
- [x] 实时告警，超出内容在 tabs 页的内容区域出现滚动条
- [x] 实时告警增加 IO 告警类型
- [x] 实时告警删除间隔时间初始值 5 秒，可以由用户设置；到时做一个全局状态
- [x] 实时告警单击，显示黄色边框，自动播放视频
- [x] 实时告警自动轮播
- [x] 实时告警双击，显示红色边框，不执行删除操作
- [x] 历史告警，告警查询
- [x] 查询历史视频
- [x] 比例尺
- [x] 点坐标
- [x] 地图全屏切换
- [x] 瓦片地图
- [x] 显示轨迹
- [x] 目标跟踪
- [x] 点击符号弹窗
- [x] 联动播放视频
- [x] 地图资源列表
- [x] 地图防区管理
- [x] 视频服务
- [x] 地图服务
- [x] 配置服务
- [x] 防区状态和设备状态，父组件控制 echarts 重新渲染
- [x] 摄像机列表
- [x] 用户-交班
- [x] 操作日志
- [x] 设备日志
- [x] 系统配置
- [ ] 帮助
- [x] 关于
- [x] websocket 重连程序
- [x] 部署，服务器 6000-7000 端口还没有人用
- [ ] history 历史模式，服务器配置
- [ ] 防区管理，历史告警查询，表单项联动；选择了防区名称，分组和状态啥的都置空且不可选中状态
- [x] 地图上符号弹窗的样式完善
- [x] 历史告警查询，表格操作事件
- [x] 防区管理
- [ ] 轨迹显示的文字 方向 速度样式
- [x] 点击显示轨迹，不触发告警的单击事件
- [ ] 地图资源列表的显示隐藏
- [x] 自动轮播告警视频
- [x] 交接班，弹出登录表单
- [x] 防区管理，旁路的方法有问题
- [x] 系统配置中都用数字的形式
- [x] 添加上系统标题
- [x] 弹窗设置 min-height
- [ ] 封装 useRequest
- [x] 时间选择器设置默认时间,开始时间为当前时间的小时树-1
- [x] 实时告警单击播放视频，改成自动轮播的一样的播放历史视频
- [x] 地图清除轨迹点
- [x] 关闭 IO 设备的 websocket
- [x] 交接班，不能同一个用户交接班，后端出来，但前端要有相应的提示
- [x] 自动播放视频与单击播放视频的关系
- [ ] 视频播放完的处理逻辑，恢复到封面状态
- [ ] ----------------2022.11.18--------------
- [x] 屏蔽掉浏览器的右键点击事件
- [x] 解决实时告警样式的问题
- [ ] 储存在 localstorage 中的用户密码加密

## 逻辑说明

- 实时告警单击，出现黄色边框，黄色边框消失的条件：

  1.点击其他实时告警信息

  2.达到播放时间，自动播放下一条告警信息

  3.点击地图上雷达，播放视频

- 实时告警，视频播放逻辑：告警关联是雷达，一个雷达会有多个摄像头，一条告警就会对应多个摄像头（多个视频墙播放窗格）；

  当轮到下一个告警时，把上一条告警的视频全部关闭，播放新的告警雷达关联的相机视频； 在地图上只有相机有播放视频的选项，播放相机视频只占用视频墙一个窗格； 当一条报警持续发生，也会自动播放下一条告警；没有下一条告警时，当前报警消失之后，视频墙恢复封面状态

- 实时报警播放视频，是不是从当前时间开始播放视频？

  答：是从当前时间开始播放。这样播放持续多长时间？可以设置，默认 15 秒。累加的告警多了，等到后面的告警也是从当前时间播放会不会就延迟了？答：这种情况就不管了

- 实时告警自动播放视频与单击播放视频的关系？

  答：单击播放优先级高于自动播放。自动播放可以用数组储存用来管理自动播放视频，当播放完单击视频就去查找数组中还有没有要播放的视频，有的话就继续进行播放

- 比如有一条实时告警正在播放视频，但是还没有播放到 60 秒，播放到 30 秒了，用户点击了其他一条实时告警，等用户点击的告警播放完了，还去播放之前的没有播放完的那段视频吗？还是按着之前那段视频播放完了继续播放下一条告警？

  答：按着之前那段视频播放完了进行处理

- 视频播放完的处理逻辑

  实况视频一直播放实况内容；回放视频播放完成，关闭播放窗口，回到封面状态。

- 实时告警双击，出现红色边框，红色边框消失的条件：

  1.双击告警信息，出现处置报警窗口（是一个表单）

  2.当提交表单，后端会返回信息；判断状态码是否为 200

- 如何根据告警信息获取到关联的摄像机：根据防区 id 查询相机
- 如何控制视频墙多个窗口同时播放？同时关闭？PlayerWallProcessorl 类下 play 和 closePlay 方法分别是控制视频播放和关闭
- 根据防区 id 来确定是一个报警，如果相同则只增加读秒
- 实时报警后端推送的 AlarmInfos 为什么采用数组方式储存，因为之前是如果同时出现两个目标在 AlarmInfos 中增加对象，现在是直接多推送一个对象
- 显示轨迹和目标追踪调用地图中的哪个方法？
- 报警读秒增加怎么实现？答：分成 setTimeout 与 watchEffect 两部分逻辑
-
- 为什么会有 5 秒自动删除告警功能，这样用户有段时间没有看屏幕，也自动消失就会出现这段时间什么事都没有发生的假象？

  答：如果没有自动删除的功能，用户不处理告警的时间太长的话有可能出现的告警特别多，有可能让浏览器内存崩溃的风险（当然我认为

  是一种极端的情况，紧紧是储存的文字，这得多大的量级才会引起浏览器崩溃）

- 播放历史视频怎么实现的？

  答：playHisSelect（id, start_time, end_time）方法用于播放历史视频，弹窗用于查询历史告警，调用防区管理中的历史告警接口；返回的信息中有开始时间和结束时间

- 防区管理

  答：实现一个查询+改变布防，撤防，旁路，三种状态。只实现客户端中的防区管理的状态功能

- 防区计划

  答：分页获取防区返回的有个 planned 字段，当 planned = null 时，是 7\*24 小时（没有计划默认布防）；有值时，拿着值访问获取指定防区计划接口

- 实时告警消失的条件

  处置告警成功，理解删除实时告警（目标+IO）；目标告警，当 websocket5 秒不再推送，删除；IO 告警，超过 20 条删除最前面的一条

- 如果一个防区没有绑定任何相机，怎么播放视频？

* 需要设置环境变量的地方?1.websocket 地址；2.帮助文档的路径

## 后端返回的字段含义

### 参数查询要素

`level` : group 类型的 level 等级是 1，要素的 level 是 3 或者 2(包括 3D 模型)

`propertytype`: 3D 模型的 propertytype 值是 0,其余在 apifox 中有说明

`elementtype`: 雷达、摄像机、警灯警号都是 point；3D 模型是 model
